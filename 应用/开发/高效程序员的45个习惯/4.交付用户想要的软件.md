# 交付用户需要的软件

设计是软件开发的基础，没有它很难做好开发，但你也不能被它牵制。

为了降低集成新代码带来的破坏性变化，提早集成，频繁集成；为了使用演示获得频繁反馈，你需要提早实现自动化部署。使用短迭代，增量发布来帮助经常发布新功能，与用户的需求变化联系更紧密。

最后，特别是客户要求预先签订固定价格合约时，很难通过敏捷的方法让客户与我们同坐一条船上。而且，事实上是固定的价格就意味着背叛承诺。


## 习惯建议：
### 让客户做决定
> 拒绝诱惑
- 诱惑魔鬼：“开发者兼具创新和智慧，最了解应用程序。因此，所有关键决定都应该由开发者定夺。每次业务人员介入的时候，都会弄得一团糟，他们无法理解我们做事的逻辑。”
    - 你只有一个选择：要么现在就让用户做决定，要么现在就开始开发，迟些让用户决定，不过要付出较高的成本。如果你在开发阶段回避这些问题，就增加了风险，但是你要能越早解决这些问题，就越有可能避免繁重的重新设计和编码。甚至在接近项目最终期限的时候，也能避免与日俱增的时间压力。
- 守护天使：“让你的客户做决定。开发者、经理或者业务分析师不应该做业务方面的决定。用业务负责人能够理解的语言，向他们详细解释遇到的问题，并让他们做决定。”
    - 当你和客户讨论问题的时候，准备好几种可选择的方案。不是从技术的角度，而是从业务的角度，介绍每种方案的优缺点，以及潜在的成本和利益。和他们讨论每个选择对时间和预算的影响，以及如何权衡。无论他们做出了什么决定，他们必须接受它，所以最好让他们了解一切之后再做这些决定。如果事后他们又想要其他的东西，可以公正地就成本和时间重新谈判。

> 切身感受：业务应用需要开发者和业务负责人互相配合来开发。这种配合的感觉就应该像一种良好的、诚实的工作关系。

> 平衡艺术：
- 记录客户做出的决定，并注明原因。但是也要注意，你选择的记录方法不能太笨重或者太繁琐。
- 如果业务负责人回答“我不知道”，这也是一个称心如意的答案。也许是他们还没有想到那么远，也许是他们只有看到运行的实物才能评估出结果。尽你所能为他们提供建议，实现代码的时候也要考虑可能出现的变化。


### 让设计指导而不是操纵开发
> 拒绝诱惑
- 诱惑魔鬼：“设计文档应该尽可能详细，这样，低级的代码工人只要敲入代码就可以了。在高层方面，详细描述对象的关联关系；在低层方面，详细描述对象之间的交互。其中一定要包括方法的实现信息和参数的注释。也不要忘记给出类里面的所有字段。编写代码的时候，无论你发现了什么，绝不能偏离了设计文档。”
    - 项目管理者和企业主常常为开发细节困扰，他们希望在开始编码之前，先有完整的设计和文档。
    - 设计满足实现即可，不必过于详细。严格的需求—设计—代码—测试开发流程源于理想化的瀑布式开发方法，它导致在前面进行了过度的设计。这样在项目的生命周期中，更新和维护这些详细的设计文档变成了主要工作，需要时间和资源方面的巨大投资，却只有很少的回报。
    - 设计可以分为两层：战略（CRC：类—职责—协作卡片的设计方法)和战术。如果你自己都不清楚所谈论的东西，就根本不可能精确地描述它。——约翰·冯·诺依曼
- 守护天使：“好设计是一张地图，它也会进化。设计指引你向正确的方向前进，你不要被设计（或者设计师）操纵。”
    - 画关键工作图（例如，用UML）是必不可少的，因为要使用类及其交互关系来描绘系统是如何组织的。在做设计的时候，你需要花时间去思考（讨论）各种不同选择的缺陷和益处，以及如何做权衡。
    - 然后，下一步才考虑是否需要开始编码。如果你在前期没有考虑清楚这些问题，就草草地开始编码，很可能会被很多意料之外的问题搞晕。
    - 时刻谨记，此阶段提出的设计只是基于你目前对需求的理解而已。一旦开始了编码，一切都会改变。设计及其代码实现会不停地发展和变化。

> 切身感受：好的设计应该是正确的，而不是精确的。也就是说，它描述的一切必须是正确的，不应该涉及不确定或者可能会发生变化的细节。它是目标，不是具体的处方。

> 平衡艺术：
- 白板、草图、便利贴都是非常好的设计工具。复杂的建模工具只会让你分散精力，而不是启发你的工作。
- 在没有经过真正的代码验证之前，不要陷入太多的设计任务。当对设计一无所知的时候，投入编码也是一件危险的事。 


### 合理地使用技术
> 拒绝诱惑
- 诱惑魔鬼：“你开始了一个新的项目，在你面前有一长串关于新技术和应用框架的列表。这些都是好东西，你真的需要使用列表中所有的技术。想一想，你的简历上将留下漂亮的一笔，用那些伟大的框架，你的新应用将具有极高技术含量。” 
    - 不要开发你能下载到的东西。
    - 你的代码写得越少，需要维护的东西就越少。
- 守护天使：“根据需要选择技术。首先决定什么是你需要的，接着为这些具体的问题评估使用技术。对任何要使用的技术，多问一些挑剔的问题，并真实地作出回答。”
    - 在考虑引入新技术或框架之前，先要把你需要解决的问题找出来。你的表述方式不同，会让结果有很大差异。
    - 找到了需要解决的问题，接下来就要考虑：
        1. 这个技术框架真能解决这个问题吗？或者，更尖锐一点说，你是如何评估这个技术的？要确保它能解决你的问题，并没有任何的毒副作用。如果需要，先做一个小的原型。
        2. 你将会被它拴住吗？一些技术是贼船，一旦你使用了它，就会被它套牢，再也不可能回头了。它缺乏可取消性（查阅[HT00]），当条件发生变化时，这可能对项目有致命打击。
        3. 维护成本是多少？会不会随着时间的推移，它的维护成本会非常昂贵？毕竟，方案的花费不应该高于要解决的问题，否则就是一次失败的投资。

> 切身感受：新技术就应该像是新的工具，可以帮助你更好地工作，它自己不应该成为你的工作。

> 平衡艺术：
- 每一门技术都会有优点和缺点，无论它是开源的还是商业产品、框架、工具或者语言，一定要清楚它的利弊。
- 不要开发那些你容易下载到的东西。虽然有时需要从最基础开发所有你需要的东西，但那是相当危险和昂贵的。 


### 合理地使用技术
> 拒绝诱惑
- 诱惑魔鬼：“我们刚试用的时候发现了一个问题，你需要立即修复它。放下你手头的工作，去修复那个刚发现的问题，不需要经过正规的程序。不用告诉其他任何人——赶快让它工作就行了。”
    - 在团队里工作，修改一些东西的时候必须很谨慎。你要时刻警惕，每次改动都会影响系统的状态和整个团队的工作效率。
- 守护天使：“保持你的项目时刻可以发布。保证你的系统随时可以编译、运行、测试并立即部署。”
    - 在本地运行测试。先保证你完成的代码可以编译，并且能通过所有的单元测试。接着确保系统中的其他测试都可以通过。
    - 检出最新的代码。从版本控制系统中更新代码到最新的版本，再编译和运行测试。这样往往会发现让你吃惊的事情：其他人提交的新代码和你的代码发生了冲突。
    - 提交代码。现在是最新的代码了，并且通过了编译和测试，你可以提交它们了。
    - 为数据库的表结构、外部文件，甚至引用它的API提供版本支持，这样所有相关变化都可以进行测试。有了版本功能，所做的变化可以与其他代码基相隔离。

> 切身感受：你会觉得，不管什么时候，你的老板、董事长、质量保障人员、客户或者你的配偶来公司参观项目的时候，你都能很自信并毫不犹豫地给他们演示最新构建的软件。你的项目一直处于可以运行的稳定状态。

> 平衡艺术：
- 有时候，做一些大的改动后，你无法花费太多的时间和精力去保证系统一直可以发布。但这只应该是例外，不能养成习惯。
- 如果你不得不让系统长期不可以发布，那就做一个（代码和架构的）分支版本，你可以继续进行自己的实验，如果不行，还可以撤销，从头再来。千万不能让系统既不可以发布，又不可以撤销。


### 提早集成，频繁集成
> 拒绝诱惑
- 诱惑魔鬼：“只要没有到开发的末尾阶段，就不要过早地浪费时间去想如何集成你的代码，至少也要等开发差不多的时候，才开始考虑它。毕竟，还没有完成开发，为什么要操心集成的事情呢！在项目的末尾，你有充裕的时间来集成代码。”
    - 每次到项目结束的时候都觉得非常不爽，大家需要日日夜夜地进行集成。
- 守护天使：“提早集成，频繁集成。代码集成是主要的风险来源。要想规避这个风险，只有提早集成，持续而有规律地进行集成。”
    - 集成和独立不是互相矛盾的，你可以一边进行集成，一边进行独立开发。
    - 决不要做大爆炸式的集成。当早期就进行集成的时候，你会看到子系统之间的交互和影响，你就可以估算它们之间通信和共享的信息数据。你越早弄清楚这些问题，越早解决它们，工作量就越小。

> 切身感受：如果你真正做对了，集成就不再会是一个繁重的任务。它只是编写代码周期中的一部分。集成时产生的问题，都会是小问题并且容易解决。

> 平衡艺术：
- 成功的集成就意味着所有的单元测试不停地通过。
- 如果你集成得不够频繁，也许就会发现整天在解决代码集成带来的问题，而不是在专心写代码。如果你集成的问题很大，那一定是做得不够频繁。
- 对那些原型和实验代码，也许你想要独立开发，而不要想在集成上浪费时间。但是不能独立开发太长的时间。一旦你有了经验，就要快速地开始集成。


### 提早实现自动化部署
> 拒绝诱惑
- 诱惑魔鬼：“没问题，可以手工安装产品，尤其是给质量保证人员安装。而且你不需要经常自己动手，他们都很擅长复制需要的所有文件。”
- 守护天使：“一开始就实现自动化部署应用。使用部署系统安装你的应用，在不同的机器上用不同的配置文件测试依赖的问题。质量保证人员要像测试应用一样测试部署。”
    - 有了自动化部署系统后，在项目开发的整个过程中，会更容易适应互相依赖的变化。

> 切身感受：这些工作都应该是无形的。系统的安装或者部署应该简单、可靠及可重复。一切都很自然。

> 平衡艺术：
- 一般产品在安装的时候，都需要有相应的软、硬件环境。比如，Java或Ruby的某个版本、外部数据库或者操作系统。这些环境的不同很可能会导致很多技术支持的电话。所以检查这些依赖关系，也是安装过程的一部分。


### 使用演示获得频繁反馈
> 拒绝诱惑
- 诱惑魔鬼：“这不是你的过错，问题出在我们的客户——那些麻烦的最终客户和用户身上。他们不停地更改需求，导致我们严重地延期。他们一次就应该想清楚所有想要的东西，然后把这些需求给我们，这样我们才能开发出令他们满意的系统。这才是正确的工作方式。”
    - 你时常会听到一些人想要冻结需求。但是，现实世界中的需求就像是流动着的油墨，是无法冻结的。就算你真的冻结了，也很可能是冻结了错的东西。
- 守护天使：“清晰可见的开发。在开发的时候，要保持应用可见（而且客户心中也要了解）。每隔一周或者两周，邀请所有的客户，给他们演示最新完成的功能，积极获得他们的反馈。”
    - 作为人类，不管是什么事情，我们都能越做越好，不过是以缓慢而逐步的方式。你的客户也一样。在给了你需求之后，他们会不停地研究这些功能，如何才能让它们变得更好使用。

> 切身感受：
- 项目启动了一段时间之后，你应该进入一种舒适的状态，团队和客户建立了一种健康的富有创造性的关系。突发事件应极少发生。
- 客户应该能感觉到，他们可以在一定程度上控制项目的方向。

> 平衡艺术：
- 演示是用来让客户提出反馈的，有助于驾驭项目的方向。如果缺少功能或者稳定性的时候，不应该拿来演示，那只能让人生气。


### 使用短迭代，增量发布
> 拒绝诱惑
- 诱惑魔鬼：“我们为后面的3年制定了漂亮的项目计划，列出了所有的任务和可交付的时间表。只要我们那时候发布了产品，就可以占领市场。” 
    - 大型系统更容易失败。它们通常不遵守迭代和增量开发的计划，或者迭代时间太长。
    - 如果目标很遥远，就很难让自己去专注于它。在这个快节奏的社会，我们都希望更快地得到结果，希望更快地见到有形的东西。这不一定是坏事，相反，它会是一件好事，只要把它转化成生产率和正面的反馈。
- 守护天使：“增量开发。发布带有最小却可用功能块的产品。每个增量开发中，使用1~4周左右迭代周期。”
    - 询问用户，哪些是使产品可用且不可缺少的核心功能。不要为所有可能需要的华丽功能而分心，不要沉迷于你的想象，去做那些华而不实的用户界面。

> 切身感受：短迭代让人感觉非常专注且具效率。你能看到一个实际并且确切的目标。严格的最终期限迫使你做出一些艰难的决策，没有遗留下长期悬而未决的问题。

> 平衡艺术：
- 如果每个迭代的时间都不够用，要么是任务太大，要么是迭代的时间太短（这是平均数据，不要因为一次迭代的古怪情况而去调整迭代时间）。把握好自己的节奏。
- 用户的需要、技术和我们对需求的理解，都会随着时间的推移而变化，在项目发布的时候，需要清楚地反映出这些变化。
- 增量的发布必须是可用的，并且能为用户提供价值。你怎么知道用户会觉得有价值呢？这当然要去问用户。


### 固定的价格就意味着背叛承诺
> 拒绝诱惑
- 诱惑魔鬼：“对这个项目，我们必须要有固定的报价。虽然我们还不清楚项目的具体情况，但仍要有一个报价。到星期一，我需要整个团队的评估，并且我们必须要在年末交付整个项目。” 
- 守护天使：“基于真实工作的评估。让团队和客户一起，真正地在当前项目中工作，做具体实际的评估。由客户控制他们要的功能和预算。”

> 切身感受：你的评估数据会在整个项目中发生变化——它们不是固定的。但是，你会觉得自信心在不断增加，你会越来越清楚每个迭代可以完成的工作。随着时间的推移，你的评估能力会不断地提高。

> 平衡艺术：
- 如果你对答案不满意，那么看看你是否可以改变问题。
- 如果你现在别无选择，你不得不提供一个固定的价格，那么你需要学到真正好的评估技巧。
