# 敏捷调试

在调试时面对的真正问题，是无法用固定的时间来限制。可以规定设计会议的持续时间，并在时间截止时决定采用最佳的方案。但是调试所耗费的时间，可能是一个小时、一天，甚至一周过去了，还是没有办法找到并解决问题。 不过，我们可以使用一些辅助技术，涵盖的范围包括：保留以前的问题解决方案，以及提供发生问题时的更多有用细节。



### 记录问题解决日志
> 拒绝诱惑 
- 诱惑魔鬼：“在开发过程中是不是经常遇到似曾相识的问题？这没关系。以前解决过的问题，现在还是可以解决掉的。” 
    - 面对问题（并解决它们）是开发人员的一种生活方式。 然而，有时一个问题看起来跟以前遇到的完全一样，但是我们却不记得是如何修复的了。这种状况时常发生。
- 守护天使：“维护一个问题及其解决方案的日志。保留解决方案是修复问题过程的一部分，以后发生相同或类似问题时，就可以很快找到并使用了。 ”

> 切身感受：解决方案日志应该作为思考的一个来源，可以在其中发现某些特定问题的细节。对于某些类似但是有差异的问题，也能从中获得修复的指引。

> 平衡艺术：
- 记录问题要保持轻量级和简单，不必达到对外发布式的质量。
- 找到以前的解决方法非常关键。使用足够的关键字，可以帮助你在需要的时候发现需要的条目。
- 如果通过搜索Web，发现没人曾经遇到同样的问题，也许搜索的方式有问题。
- 要记录发生问题时应用程序、应用框架或平台的特定版本。同样的问题在不同的平台或版本上可能表现得不同。
- 要记录团队做出一个重要决策的原因。否则，在6~9个月之后，想再重新回顾决策过程的时候，这些细节就很难再记得了，很容易发生互相指责的情形。



### 警告即是错误
> 拒绝诱惑 
- 诱惑魔鬼：“编译器的警告信息只不过是给过分小心和过于书呆子气的人看的。它们只是警告而已。如果导致的后果很严重，它们就是错误了，而且会导致无法通过编译。所以干脆忽略它们就是了。” 
- 守护天使：“将警告视为错误。签入带有警告的代码，就跟签入有错误或者没有通过测试的代码一样，都是极差的做法。签入构建工具中的代码不应该产生任何警告信息。”
    - 在开始一个项目的时候，要把相关的设置都准备好。在项目进行到一半的时候，突然改变警告设置，有可能会带来颠覆性的后果，导致难以控制。

> 切身感受：警告给人的感觉就像……哦，警告。它们就某些问题给出警告，来吸引开发人的注意。

> 平衡艺术：
- 由于编译器的bug或是第三方工具或代码的原因，有些警告无法消除。如果确实没有应对之策的话，就不要再浪费更多时间了。但是类似的状况很少发生。
- 应该经常指示编译器：要特别注意别将无法避免的警告作为错误进行提示，这样就不用费力去查看所有的提示，以找到真正的错误和警告。



### 对问题各个击破
> 拒绝诱惑 
- 诱惑魔鬼：“逐行检查代码库中的代码确实很令人恐惧。但是要调试一个明显的错误，只有去查看整个系统的代码，而且要全部过一遍。毕竟你不知道问题可能发生在什么地方，这样做是找到它的唯一方式。” 
    - 单元测试带来的积极效应之一，是它会强迫形成代码的分层。要保证代码可测试，就必须把它从周边代码中解脱出来。 
- 守护天使：“对问题各个击破。在解决问题时，要将问题域与其周边隔离开，特别是在大型应用中。 ”
    - 不要试图马上了解系统的所有细节。要想认真调试，就必须将有问题的组件或模块与其他代码库分离开来。

> 切身感受：面对必须要隔离的问题时，感觉就像在一个茶杯中寻找一根针，而不是大海捞针。

> 平衡艺术：
- 在向问题发起攻击之前，先查找你的问题解决日志。


### 报告所有异常
> 拒绝诱惑 
- 诱惑魔鬼：“不要让程序的调用者看到那些奇怪的异常。处理它们是你的责任。把你调用的一切都包起来，然后发送自己定义的异常——或者干脆自己解决掉。” 
- 守护天使：“处理或是向上传播所有的异常。不要将它们压制不管，就算是临时这样做也不行。在写代码时要估计到会发生的问题。”

> 切身感受：当出现问题时，心里知道能够得到抛出的异常。而且没有空的异常处理方法。

> 平衡艺术：
- 不是所有的问题都应该抛出异常。
- 报告的异常应该在代码的上下文中有实际意义。
- 要传播不能处理的异常。


### 提供有用的错误信息
> 拒绝诱惑 
- 诱惑魔鬼：“不要吓着用户，吓程序员也不行。要提供给他们干净整洁的错误信息。要使用如下这样让人舒服的词句：‘用户错误。替换，然后继续’。” 
    - 错误报告对于开发人员的生产率，以及最终的支持活动消耗成本，都有很大的影响。在开发过程中，如果定位和修复问题让人倍受挫折，就考虑使用更加积极主动的错误报告方式吧。调试信息非常宝贵，而且不易获得。不要轻易将其丢弃。
- 守护天使：“展示有用的错误信息。提供更易于查找错误细节的方式。发生问题时，要展示出尽量多的支持细节，不过别让用户陷入其中。”
    - 错误类型：1. 程序缺陷，2. 环境问题，3. 用户错误。

> 切身感受：错误信息有助于问题的解决。当问题发生时，可以详细研究问题的细节描述和发生上下文。

> 平衡艺术：
- 在提供更多信息的同时，不要泄露安全信息、个人隐私、商业机密，或其他敏感信息（对于基于Web的应用，这一点尤其重要）。
- 如果你不确定一个接口做出了什么样的承诺，或是有什么样的需求，那就很难提供一个对其有意义的实现了。
